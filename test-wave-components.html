<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµªé«˜åˆ†é‡æ•°æ®æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-card { 
            background: white; 
            border-radius: 8px; 
            padding: 20px; 
            margin: 20px 0; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .data-item { 
            display: flex; 
            justify-content: space-between; 
            padding: 8px 0; 
            border-bottom: 1px solid #eee;
        }
        .data-item:last-child { border-bottom: none; }
        .value { font-weight: bold; color: #007bff; }
        .source-windy { color: #28a745; }
        .source-fallback { color: #ffc107; }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 10px 5px;
        }
        button:hover { background: #0056b3; }
        .loading { text-align: center; color: #666; }
        .error { color: #dc3545; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒŠ æµªé«˜åˆ†é‡æ•°æ®æµ‹è¯•</h1>
        <p>æµ‹è¯•APIè°ƒç”¨è¿”å›çš„æ€»æµªé«˜ã€é£æµªåˆ†é‡ã€æ¶Œæµªåˆ†é‡å’Œæ—¶é—´æˆ³æ•°æ®</p>
        
        <div>
            <button onclick="testHainanSpot()">æµ‹è¯•æµ·å—æµªç‚¹</button>
            <button onclick="testQingdaoSpot()">æµ‹è¯•é’å²›æµªç‚¹</button>
            <button onclick="testZhoushanSpot()">æµ‹è¯•èˆŸå±±æµªç‚¹</button>
            <button onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
        </div>
        
        <div id="results"></div>
    </div>

    <script src="js/windy-service.js"></script>
    <script>
        // æµ‹è¯•æµªç‚¹åæ ‡
        const testSpots = {
            hainan: { name: "æµ·å—-é™µæ°´ä¸‡è±ª", lat: 18.527192, lng: 110.107462 },
            qingdao: { name: "é’å²›-çŸ³è€äºº", lat: 36.088937, lng: 120.46526 },
            zhoushan: { name: "èˆŸå±±-ä¸œæ²™", lat: 30.0444, lng: 122.1067 }
        };

        async function testSpot(spotKey) {
            const spot = testSpots[spotKey];
            const resultsDiv = document.getElementById('results');
            
            // æ·»åŠ åŠ è½½çŠ¶æ€
            const loadingCard = document.createElement('div');
            loadingCard.className = 'test-card';
            loadingCard.innerHTML = `
                <h3>${spot.name}</h3>
                <div class="loading">æ­£åœ¨è·å–æ•°æ®...</div>
            `;
            resultsDiv.appendChild(loadingCard);

            try {
                console.log(`Testing ${spot.name} at coordinates:`, spot.lat, spot.lng);
                
                const data = await windyService.getWaveData(spot.lat, spot.lng);
                console.log(`Data received for ${spot.name}:`, data);
                
                // ç§»é™¤åŠ è½½çŠ¶æ€
                resultsDiv.removeChild(loadingCard);
                
                // æ˜¾ç¤ºç»“æœ
                const resultCard = document.createElement('div');
                resultCard.className = 'test-card';
                
                let html = `<h3>${spot.name} (${spot.lat}, ${spot.lng})</h3>`;
                
                if (data && data.forecast && data.forecast.length > 0) {
                    html += `<p>è·å–åˆ° ${data.forecast.length} ä¸ªé¢„æµ‹ç‚¹</p>`;
                    
                    // æ˜¾ç¤ºå‰3ä¸ªé¢„æµ‹ç‚¹çš„è¯¦ç»†æ•°æ®
                    data.forecast.slice(0, 3).forEach((forecast, index) => {
                        const sourceClass = forecast.source === 'windy' ? 'source-windy' : 'source-fallback';
                        html += `
                            <div style="margin: 15px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px;">
                                <h4>é¢„æµ‹ç‚¹ ${index + 1} - ${forecast.date} ${forecast.time || ''}</h4>
                                <div class="data-item">
                                    <span>æ€»æµªé«˜ (waves_height-surface):</span>
                                    <span class="value">${forecast.totalWaveHeight || forecast.waveHeight}m</span>
                                </div>
                                <div class="data-item">
                                    <span>é£æµªåˆ†é‡ (wwaves_height-surface):</span>
                                    <span class="value">${forecast.windWaveHeight || 'N/A'}m</span>
                                </div>
                                <div class="data-item">
                                    <span>æ¶Œæµªåˆ†é‡ (swell1_height-surface):</span>
                                    <span class="value">${forecast.swellHeight || 'N/A'}m</span>
                                </div>
                                <div class="data-item">
                                    <span>æ—¶é—´æˆ³ (ts):</span>
                                    <span class="value">${forecast.timestamp}</span>
                                </div>
                                <div class="data-item">
                                    <span>æ•°æ®æº:</span>
                                    <span class="value ${sourceClass}">${forecast.source === 'windy' ? 'Windy API (å®æ—¶)' : 'æ¨¡æ‹Ÿæ•°æ®'}</span>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    html += '<div class="error">æœªè·å–åˆ°é¢„æµ‹æ•°æ®</div>';
                }
                
                resultCard.innerHTML = html;
                resultsDiv.appendChild(resultCard);
                
            } catch (error) {
                console.error(`Error testing ${spot.name}:`, error);
                
                // ç§»é™¤åŠ è½½çŠ¶æ€
                if (resultsDiv.contains(loadingCard)) {
                    resultsDiv.removeChild(loadingCard);
                }
                
                // æ˜¾ç¤ºé”™è¯¯
                const errorCard = document.createElement('div');
                errorCard.className = 'test-card';
                errorCard.innerHTML = `
                    <h3>${spot.name}</h3>
                    <div class="error">é”™è¯¯: ${error.message}</div>
                `;
                resultsDiv.appendChild(errorCard);
            }
        }

        function testHainanSpot() {
            testSpot('hainan');
        }

        function testQingdaoSpot() {
            testSpot('qingdao');
        }

        function testZhoushanSpot() {
            testSpot('zhoushan');
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºè¯´æ˜
        document.addEventListener('DOMContentLoaded', function() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div class="test-card">
                    <h3>æµ‹è¯•è¯´æ˜</h3>
                    <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•APIè°ƒç”¨æ˜¯å¦æ­£ç¡®è¿”å›ä»¥ä¸‹4ä¸ªå…³é”®æ•°å€¼ï¼š</p>
                    <ul>
                        <li><strong>æ€»æµªé«˜</strong> (waves_height-surface) - æµ·é¢æ€»ä½“æµªé«˜</li>
                        <li><strong>é£æµªåˆ†é‡</strong> (wwaves_height-surface) - ç”±é£åŠ›äº§ç”Ÿçš„æµªé«˜</li>
                        <li><strong>æ¶Œæµªåˆ†é‡</strong> (swell1_height-surface) - è¿œç¨‹ä¼ æ’­çš„æ¶Œæµªé«˜åº¦</li>
                        <li><strong>æ—¶é—´æˆ³</strong> (ts) - é¢„æµ‹æ—¶é—´ç‚¹</li>
                    </ul>
                    <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æµ‹è¯•ä¸åŒåœ°åŒºçš„æµªç‚¹æ•°æ®ã€‚</p>
                </div>
            `;
        });
    </script>
</body>
</html>